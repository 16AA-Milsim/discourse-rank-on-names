<div class="rank-on-names-admin">
  {{#if this.disabled}}
    <div class="alert alert-info">
      {{i18n "rank_on_names.disabled_message"}}
    </div>
  {{/if}}

  <p class="rank-on-names-admin__description">
    {{i18n "rank_on_names.description"}}
  </p>

  <div class="table-container">
    <table class="table rank-on-names-admin__table">
      <thead>
        <tr>
          <th>{{i18n "rank_on_names.group_name"}}</th>
          <th>{{i18n "rank_on_names.prefix"}}</th>
          <th class="rank-on-names-admin__position">
            {{i18n "rank_on_names.position"}}
          </th>
          <th class="rank-on-names-admin__actions">
            {{i18n "rank_on_names.actions"}}
          </th>
        </tr>
      </thead>
      <tbody>
        {{#if this.prefixes.length}}
        {{#each this.prefixes as |prefix|}}
          <tr>
            {{#if prefix.isEditing}}
                <td>
                  <Input
                    @value={{prefix._edit.group_name}}
                    @type="text"
                    class="input-small"
                    placeholder={{i18n "rank_on_names.group_placeholder"}}
                    {{on "input" (fn this.updateEditField prefix.id "group_name")}}
                  />
                </td>
                <td>
                  <Input
                    @value={{prefix._edit.prefix}}
                    @type="text"
                    class="input-small"
                    placeholder={{i18n "rank_on_names.prefix_placeholder"}}
                    {{on "input" (fn this.updateEditField prefix.id "prefix")}}
                  />
                </td>
                <td>
                  <Input
                    @value={{prefix._edit.position}}
                    @type="number"
                    class="input-small"
                    min="1"
                    {{on "input" (fn this.updateEditField prefix.id "position")}}
                  />
                </td>
                <td class="rank-on-names-admin__actions">
                  <DButton
                    @action={{fn this.saveEdit prefix.id}}
                    @label="rank_on_names.save"
                    @buttonClass="btn-primary btn-small"
                  />
                  <DButton
                    @action={{fn this.cancelEdit prefix.id}}
                    @label="rank_on_names.cancel"
                    @buttonClass="btn-small"
                  />
                </td>
              {{else}}
                <td>{{prefix.group_name}}</td>
                <td>{{prefix.prefix}}</td>
                <td>{{prefix.position}}</td>
                <td class="rank-on-names-admin__actions">
                  <DButton
                    @action={{fn this.startEdit prefix.id}}
                    @label="rank_on_names.edit"
                    @buttonClass="btn-small"
                  />
                  <DButton
                    @action={{fn this.deletePrefix prefix.id}}
                    @label="rank_on_names.delete"
                    @buttonClass="btn-danger btn-small"
                    @icon="trash-can"
                  />
                </td>
              {{/if}}
            </tr>
          {{/each}}
        {{else}}
          <tr>
            <td colspan="4" class="rank-on-names-admin__empty">
              {{i18n "rank_on_names.empty"}}
            </td>
          </tr>
        {{/if}}
      </tbody>
    </table>
  </div>

  <div class="rank-on-names-admin__new">
    <h3>{{i18n "rank_on_names.add_heading"}}</h3>
    <div class="rank-on-names-admin__new-grid">
      <Input
        @value={{this.newGroupName}}
        @type="text"
        class="input-small"
        placeholder={{i18n "rank_on_names.group_placeholder"}}
      />
      <Input
        @value={{this.newPrefix}}
        @type="text"
        class="input-small"
        placeholder={{i18n "rank_on_names.prefix_placeholder"}}
      />
      <Input
        @value={{this.newPosition}}
        @type="number"
        class="input-small"
        min="1"
        placeholder={{i18n "rank_on_names.position_placeholder"}}
      />
      <DButton
        @action={{this.createPrefix}}
        @label="rank_on_names.add"
        @buttonClass="btn-primary"
        @disabled={{or this.isSavingNew this.disabled}}
      />
    </div>
  </div>

  <hr class="rank-on-names-admin__divider" />

  <h2>{{i18n "rank_on_names.drop_zone.heading"}}</h2>
  <p class="rank-on-names-admin__description">
    {{i18n "rank_on_names.drop_zone.description"}}
  </p>

  <div class="table-container">
    <table class="table rank-on-names-admin__table">
      <thead>
        <tr>
          <th>{{i18n "rank_on_names.group_name"}}</th>
          <th>{{i18n "rank_on_names.drop_zone.image"}}</th>
          <th class="rank-on-names-admin__position">
            {{i18n "rank_on_names.position"}}
          </th>
          <th class="rank-on-names-admin__actions">
            {{i18n "rank_on_names.actions"}}
          </th>
        </tr>
      </thead>
      <tbody>
        {{#if this.dropZoneFlashes.length}}
          {{#each this.dropZoneFlashes as |flash|}}
            <tr>
              {{#if flash.isEditing}}
                <td>
                  <Input
                    @value={{flash._edit.group_name}}
                    @type="text"
                    class="input-small"
                    placeholder={{i18n "rank_on_names.group_placeholder"}}
                    {{on
                      "input"
                      (fn this.updateDropZoneEditField flash.id "group_name")
                    }}
                    {{on "keydown" this.stopDeletePropagation}}
                  />
                </td>
                <td>
                  <DropZoneFlashUpload
                    @upload={{flash._edit.upload}}
                    @groupName={{flash._edit.group_name}}
                    @onUpload={{fn this.setDropZoneEditUpload flash.id}}
                    @onRemove={{fn this.clearDropZoneEditUpload flash.id}}
                    @onUploadError={{this.handleDropZoneUploadError}}
                    @disabled={{this.disabled}}
                  />
                </td>
                <td>
                  <Input
                    @value={{flash._edit.position}}
                    @type="number"
                    class="input-small"
                    min="1"
                    {{on
                      "input"
                      (fn this.updateDropZoneEditField flash.id "position")
                    }}
                    {{on "keydown" this.stopDeletePropagation}}
                  />
                </td>
                <td class="rank-on-names-admin__actions">
                  <DButton
                    @action={{fn this.saveDropZoneEdit flash.id}}
                    @label="rank_on_names.save"
                    @buttonClass="btn-primary btn-small"
                  />
                  <DButton
                    @action={{fn this.cancelDropZoneEdit flash.id}}
                    @label="rank_on_names.cancel"
                    @buttonClass="btn-small"
                  />
                </td>
              {{else}}
                <td>{{flash.group_name}}</td>
                <td>
                  {{#if flash.upload_url}}
                    <img
                      src={{flash.preview_url}}
                      alt={{i18n
                        "rank_on_names.drop_zone.preview_alt"
                        group=flash.group_name
                      }}
                      width="16"
                      height="16"
                      class="rank-on-names-admin__dzf-preview"
                    />
                  {{else}}
                    <span class="rank-on-names-admin__dzf-placeholder">â€”</span>
                  {{/if}}
                </td>
                <td>{{flash.position}}</td>
                <td class="rank-on-names-admin__actions">
                  <DButton
                    @action={{fn this.startDropZoneEdit flash.id}}
                    @label="rank_on_names.edit"
                    @buttonClass="btn-small"
                  />
                  <DButton
                    @action={{fn this.deleteDropZoneFlash flash.id}}
                    @label="rank_on_names.delete"
                    @buttonClass="btn-danger btn-small"
                    @icon="trash-can"
                  />
                </td>
              {{/if}}
            </tr>
          {{/each}}
        {{else}}
          <tr>
            <td colspan="4" class="rank-on-names-admin__empty">
              {{i18n "rank_on_names.drop_zone.empty"}}
            </td>
          </tr>
        {{/if}}
      </tbody>
    </table>
  </div>

  <div class="rank-on-names-admin__dzf-new">
    <h3>{{i18n "rank_on_names.drop_zone.add_heading"}}</h3>
    <div class="rank-on-names-admin__dzf-grid">
      <Input
        @value={{this.newDropZoneGroupName}}
        @type="text"
        class="input-small"
        placeholder={{i18n "rank_on_names.group_placeholder"}}
        {{on "keydown" this.stopDeletePropagation}}
      />
      <Input
        @value={{this.newDropZonePosition}}
        @type="number"
        class="input-small"
        min="1"
        placeholder={{i18n "rank_on_names.position_placeholder"}}
        {{on "keydown" this.stopDeletePropagation}}
      />
      <DropZoneFlashUpload
        @upload={{this.newDropZoneUpload}}
        @groupName={{this.newDropZoneGroupName}}
        @onUpload={{this.setNewDropZoneUpload}}
        @onRemove={{this.clearNewDropZoneUpload}}
        @onUploadError={{this.handleDropZoneUploadError}}
        @disabled={{this.disabled}}
      />
      <DButton
        @action={{this.createDropZoneFlash}}
        @label="rank_on_names.drop_zone.add"
        @buttonClass="btn-primary"
        @disabled={{or this.isSavingDropZone this.disabled}}
      />
    </div>
  </div>
</div>
